{% extends "attendance/base.html" %}
{% block title %}シフト（日付で検索）{% endblock %}
{% block content %}
<h1 class="title">シフト（日付で検索）</h1>

<form method="get" class="box" action="{% url 'shift_list' %}">
  <div class="columns is-multiline is-vcentered">
    <div class="column is-4">
      <label class="label">日付</label>
      <div class="control">
        <input class="input" type="date" name="date" value="{{ date_value }}" required>
      </div>
      <p class="help">形式: yyyy-mm-dd（例: 2025-08-13）</p>
    </div>
    <div class="column is-4">
      <label class="label">社員検索</label>
      <div class="control">
        <input class="input" type="text" name="emp" value="{{ emp_query }}" placeholder="社員番号 or 氏名">
      </div>
      <p class="help">部分一致で検索します</p>
    </div>
    <div class="column is-4">
      <label class="label">&nbsp;</label>
      <div class="buttons">
        <button class="button is-link" type="submit">検索</button>
        <a class="button" href="{% url 'shift_list' %}?date={{ prev_date }}&emp={{ emp_query }}">← 前日</a>
        <a class="button" href="{% url 'shift_list' %}?date={{ next_date }}&emp={{ emp_query }}">翌日 →</a>
        <a class="button is-light" href="{% url 'shift_list' %}">今日</a>
      </div>
    </div>
  </div>
</form>

<div class="notification is-info is-light">
  <strong>{{ selected_date|date:"Y-m-d" }}</strong> の出勤予定：
  <strong>{{ count_employees }}</strong> 名 / シフト <strong>{{ count_shifts }}</strong> 件
</div>

<div class="box">
  <h2 class="subtitle">出勤予定の社員</h2>
  {% if employees %}
    <div class="tags">
      {% for e in employees %}
        <span class="tag is-primary">{{ e.code }} {{ e.name }}</span>
      {% endfor %}
    </div>
  {% else %}
    <p>該当する社員はいません。</p>
  {% endif %}
</div>

<div class="box">
  <h2 class="subtitle">シフト一覧</h2>
  {% if shifts %}
    <div class="table-container">
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>日付</th>
            <th>社員番号</th>
            <th>氏名</th>
            <th>開始</th>
            <th>終了</th>
            <th>備考</th>
          </tr>
        </thead>
        <tbody>
          {% for s in shifts %}
          <tr>
            <td>{{ s.date|date:"Y-m-d" }}</td>
            <td>{{ s.employee.code }}</td>
            <td>{{ s.employee.name }}</td>
            <td>{% if s.start_time %}{{ s.start_time|time:"H:i" }}{% endif %}</td>
            <td>{% if s.end_time %}{{ s.end_time|time:"H:i" }}{% endif %}</td>
            <td>{{ s.note }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>該当するシフトはありません。</p>
  {% endif %}
</div>
{% endblock %}
